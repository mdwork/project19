google.maps.Map.prototype.setCenterWithOffset = function (e, t, o) {
    var i = this, a = new google.maps.OverlayView;
    a.onAdd = function () {
        var a = this.getProjection(), l = a.fromLatLngToContainerPixel(e);
        l.x = l.x + t, l.y = l.y + o, i.setCenter(a.fromContainerPixelToLatLng(l))
    }, a.draw = function () {
    }, a.setMap(this)
};
var w = 0, h = 0;
$(document).resize(function () {
    w = $("body").width(), h = $(document).height(), $("#video-intro").css(w > h ? {
        height: w + "px",
        top: (w - h) / -2 + "px"
    } : {width: h + "px", left: (h - w) / -2 + "px"})
});
var images = 0, loaded = 0;
$.preloadCssImages = function () {
    var e = window.navigator.userAgent, t = e.indexOf("MSIE ");
    Object.hasOwnProperty.call(window, "ActiveXObject") && !window.ActiveXObject && (t = !0);
    for (var o = document.styleSheets, i = "", a = 0; a < o.length; a++)if (t > 0)i += document.styleSheets[a].cssText; else for (var l = document.styleSheets[a].cssRules, r = 0; r < l.length; r++)i += l[r].cssText;
    var n = [], s = i.match(/\burl\s*\(\s*["']?([^"'\r\n\)\(]+)["']?\s*\)/gi);
    if (null != s && s.length > 0 && "" != s) {
        var p = jQuery.makeArray(s);
        images = p.length, $(p).each(function () {
            var e = new Image, t = this.replace("url(", "").replace(")", "").replace('"', "").replace("../", "");
            "img" == t.substr(0, 3) && (t = "http://celebritycouch/public/" + t), t.search("google") > 0 ? loaded++ : (e.src = t, e.onload = function () {
                loaded++
            })
        })
    }
    return n
};
var loaded = 0;
loader = setInterval(function () {
    var e = Math.round(100 * loaded / images);
    e > loaded && loaded++, $("#loading span").html(loaded), 100 == loaded && $("#loading").addClass("final").fadeOut(200)
}, 10), $(document).ready(function () {
    function e(e) {
        "connected" === e.status ? (a = {
            id: e.authResponse.userID,
            token: e.authResponse.accessToken
        }, i = !0, FB.api("/" + a.id + "/likes/", function (e) {
            e && !e.error && console.log(e, a.id)
        })) : i = !1
    }

    function t() {
        var e = {
            acc: a.id,
            token: a.token,
            name: $("#confirm-name").val(),
            email: $("#confirm-email").val(),
            place: $("#confirm-place").val(),
            why: $("#confirm-why").val(),
            who: $("#dropdown").data("id")
        };
        $.ajax({
            type: "POST", url: "apply/", dataType: "json", data: e, success: function (e) {
                console.log(e)
            }
        })
    }

    function o() {
        FB.login(function (t) {
            return t.authResponse ? (e(t), void $("#fb").trigger("click")) : (i = !1, !1)
        }, {scope: "email"})
    }

    "ontouchstart"in document.documentElement && ($("#apply>div>div").addClass("touch"), $("#apply>div>div").on("touchend", function () {
        $(this).addClass("open")
    })), $(document).resize();
    $.preloadCssImages(), $(document).ready(function () {
        function e(e) {
            var t = parseFloat($(".pt-wrapper").data("current"));
            if (e) {
                if (7 > t && !$("#apply").is(":visible") && !$("#confirm").is(":visible") && !$("#video").is(":visible") && !$("#terms-conditions").hasClass("open"))return !0
            } else if (t >= 0 && 7 > t && !$("#apply").is(":visible") && !$("#confirm").is(":visible") && !$("#video").is(":visible") && !$("#terms-conditions").hasClass("open"))return !0;
            return !1
        }

        function t(e) {
            var t = $('<div class="marker"/>');
            t.appendTo("#map-stage"), t.css("background", '#ff004c url("public/img/icons/' + e.icn + '.png") center center no-repeat'), n = e.getMap();
            var o = Math.pow(2, n.getZoom()), i = new google.maps.LatLng(n.getBounds().getNorthEast().lat(), n.getBounds().getSouthWest().lng()), a = n.getProjection().fromLatLngToPoint(i), l = n.getProjection().fromLatLngToPoint(e.getPosition()), r = new google.maps.Point(Math.floor((l.x - a.x) * o), Math.floor((l.y - a.y) * o));
            t.data("title", e.title), t.data("text", e.text), t.data("link", e.link), t.data("fb", e.fb), t.data("img", e.imgid), setTimeout(function () {
                t.css({left: r.x - 20, top: r.y - 30}).addClass("open")
            }, 50)
        }

        var o = !1;
        $("body").on("mousewheel", {mousewheel: {behavior: "throttle", delay: 500}}, function (t) {
            var i = parseFloat($(".pt-wrapper").data("current"));
            o || (t.deltaY < 0 && e(!0) ? 6 == i ? $("#first").trigger("click") : $("#next").trigger("click") : t.deltaY > 0 && e(!1) && (0 >= i ? $("#last").trigger("click") : $("#prev").trigger("click")), o = !0, setTimeout(function () {
                o = !1
            }, 1500))
        }), $("body").keydown(function (t) {
            40 == t.keyCode && e(!0) ? 6 == i ? $("#first").trigger("click") : $("#next").trigger("click") : 38 == t.keyCode && e(!1) && (1 >= i ? $("#last").trigger("click") : $("#prev").trigger("click"))
        });
        var i, a = new Hammer(document.body);
        a.on("panup", function () {
            e(!0) && (6 == i ? $("#first").trigger("click") : $("#next").trigger("click"))
        }), a.on("pandown", function () {
            e(!1) && (1 >= i ? $("#last").trigger("click") : $("#prev").trigger("click"))
        }), $(document).bind("touchmove", function (e) {
            $("#confirm").is(":visible") || e.preventDefault()
        }), $("#toggle").click(function () {
            var e = parseFloat($(".pt-wrapper").data("current"));
            $("#apply").is(":visible") || $("#confirm").is(":visible") || $("#thanks").is(":visible") || ($(this).toggleClass("open"), 7 > e || 8 == e ? $("#nav-slides").toggleClass("open") : $("#people").toggleClass("open"))
        }), $(".pt-page").click(function () {
            $("#nav-slides,#toggle").removeClass("open")
        }), $("#nav-slides a").click(function () {
            $("#nav-slides,#toggle").removeClass("open")
        });
        var l = !0;
        $(".pt-trigger").click(function () {
            i = parseFloat($(".pt-wrapper").data("current")), $("#apply,#confirm,#thanks").hide(), $("#popup").removeClass("open");
            var e = $(".marker");
            e.removeClass("open active"), setTimeout(function () {
                e.remove()
            }, 200), 7 > i ? ($("#bullets a").removeClass("active"), $("#bullets a:eq(" + i + ")").addClass("active"), l || ($("#bullets").addClass("open"), $("#sidebar ul a").removeClass("active"), $("#sidebar ul li:eq(1) a").addClass("active"), $("#people,#toggle").removeClass("open")), l = !0) : ($("#sidebar ul a").removeClass("active"), l && $("#bullets,#nav-slides,#toggle").removeClass("open"), 7 == i ? ($("#sidebar ul li:eq(2) a").addClass("active"), $("#people,#toggle").addClass("open"), $("").addClass("open")) : (8 == i && $("#sidebar ul li:eq(0) a").addClass("active"), $("#people,#toggle").removeClass("open")), l = !1)
        });
        {
            var r = [{
                featureType: "water",
                elementType: "geometry",
                stylers: [{color: "#454545"}]
            }, {
                featureType: "landscape",
                elementType: "geometry",
                stylers: [{color: "#2a2f37"}]
            }, {
                featureType: "road.highway",
                elementType: "geometry.fill",
                stylers: [{color: "#454545"}]
            }, {
                featureType: "road.highway",
                elementType: "geometry.stroke",
                stylers: [{color: "#454545"}, {weight: .2}]
            }, {featureType: "road.local", elementType: "geometry", stylers: [{color: "#454545"}]}, {
                featureType: "poi",
                elementType: "geometry",
                stylers: [{visibility: "off"}, {lightness: 21}]
            }, {
                featureType: "all",
                elementType: "labels.text.stroke",
                stylers: [{visibility: "on"}, {color: "#454545"}, {lightness: 16}]
            }, {
                featureType: "all",
                elementType: "labels.text.fill",
                stylers: [{color: "#454545"}, {saturation: 36}, {lightness: 40}]
            }, {
                featureType: "all",
                elementType: "labels.icon",
                stylers: [{visibility: "off"}]
            }, {
                featureType: "transit",
                elementType: "geometry",
                stylers: [{color: "#454545"}, {lightness: 19}]
            }, {
                featureType: "administrative",
                elementType: "geometry.fill",
                stylers: [{visibility: "off"}]
            }, {
                featureType: "administrative",
                elementType: "geometry.stroke",
                stylers: [{visibility: "off"}]
            }, {
                featureType: "transit.station.airport",
                elementType: "geometry",
                stylers: [{visibility: "off"}]
            }, {
                featureType: "transit.station.airport",
                elementType: "labels",
                stylers: [{visibility: "off"}]
            }, {featureType: "road", elementType: "geometry", stylers: [{color: "#454545"}]}, {
                featureType: "road",
                elementType: "labels",
                stylers: [{visibility: "simplified"}]
            }, {
                featureType: "administrative",
                elementType: "labels",
                stylers: [{visibility: "off"}]
            }, {
                featureType: "poi",
                elementType: "labels",
                stylers: [{visibility: "off"}]
            }, {featureType: "transit.line", elementType: "all", stylers: [{visibility: "off"}]}, {
                featureType: "water",
                elementType: "labels",
                stylers: [{visibility: "off"}]
            }, {
                featureType: "road.highway",
                elementType: "labels",
                stylers: [{visibility: "off"}]
            }, {
                featureType: "road.arterial",
                elementType: "labels",
                stylers: [{visibility: "off"}]
            }, {featureType: "landscape.natural", elementType: "labels", stylers: [{visibility: "off"}]}];
            Array()
        }
        $("#map").gmap({
            disableDefaultUI: !0,
            scrollwheel: !1,
            zoomControl: !0,
            zoom: 13,
            center: new google.maps.LatLng(56.957021, 24.127923),
            styles: r,
            zoomControlOptions: {
                style: google.maps.ZoomControlStyle.SMALL,
                position: google.maps.ControlPosition.LEFT_CENTER
            }
        }).bind("mousedown", function () {
            $("#popup").removeClass("open");
            var e = $(".marker");
            e.removeClass("open active"), setTimeout(function () {
                e.remove()
            }, 200)
        });
        var n;
        $("body").on("mouseout", ".marker", function () {
            $(this).removeClass("open")
        }), $("body").on("click", ".marker", function () {
            var e = $(this).offset(), t = 0, o = 0, i = $(this), a = $(".marker").not(this);
            a.removeClass("open active"), setTimeout(function () {
                a.remove()
            }, 200), e.top > h - 300 && ($(this).css("top", e.top - 320), o = -320), e.left > w - 800 && ($(this).css("left", e.left - 340), t = -240), n.setCenterWithOffset(n.getCenter(), -1 * t, -1 * o), $("#popup h2").html(i.data("title")), $("#popup p").html(i.data("text"));
            var l = i.data("link");
            l ? ($("#popup .link").attr("href", l), $("#popup .link").show()) : $("#popup .link").hide(), $("#popup img").attr("src", ""), $("#popup img").attr("src", "public/img/places/" + i.data("img") + ".jpg"), $("#popup").addClass("open"), $(this).addClass("active"), $("#popup").css({
                top: e.top + o + 20,
                left: e.left + t - 210
            })
        }), $("#popup a.x").click(function () {
            $("#popup").removeClass("open");
            var e = $(".marker");
            e.removeClass("open active"), setTimeout(function () {
                e.remove()
            }, 200)
        }), $("#people a").click(function (e) {
            e.preventDefault();
            var t = $(this).data("id");
            $("#popup").removeClass("open");
            var o = $(".marker");
            o.removeClass("open active"), setTimeout(function () {
                o.remove()
            }, 200), $("#people a").removeClass("active"), $(this).addClass("active"), $("#map").gmap("find", "markers", {
                property: "humanoid",
                value: "" + t
            }, function (e, t) {
                e.setOpacity(t ? 1 : .2)
            })
        }), $(".map-change").click(function () {
            $("#people a:eq(" + ($(this).data("id") - 1) + ")").trigger("click")
        })
    }), $("#video-trigger").click(function () {
        var e = parseFloat($(".pt-wrapper").data("current"));
        e > 6 ? ($("#first").trigger("click"), setTimeout(function () {
            $("#toggle").trigger("click")
        }, 600)) : $("#toggle").trigger("click")
    }), $(".watch").click(function (e) {
        e.preventDefault(), $("#video-intro").show();
        var t = /(iPad|iPhone|iPod)/g.test(navigator.userAgent);
        $("#yt").tubeplayer({
            width: "100%",
            height: "100%",
            showControls: !1,
            autoPlay: !t,
            wmode: "opaque",
            preferredQuality: "large",
            initialVideo: $(this).data("id"),
            onPlayerEnded: function () {
                $("#video .x").trigger("click")
            }
        }), setTimeout(function () {
            $("#video-intro").addClass("open")
        }, 200), setTimeout(function () {
            $("#video").show()
        }, 700)
    }), $("#video .x").click(function (e) {
        e.preventDefault(), $("#video").hide(), $("#video-intro").removeClass("open"), setTimeout(function () {
            $("#yt").tubeplayer("destroy"), $("#video-intro").hide()
        }, 500)
    }), $(".apply").click(function (e) {
        e.preventDefault(), $("#apply").show(), $("#dropdown li:eq(" + ($(this).data("id") - 1) + ")").trigger("click")
    }), $("#apply .x").click(function (e) {
        e.preventDefault(), $("#apply").hide()
    }), $("#dropdown li").click(function () {
        var e = $(this), t = e.data("id");
        $("#dropdown").data("id", t), $("#dropdown li").show(), $("#dropdown strong").html(e.html()), e.hide(), $("#dropdown ul").hide(), setTimeout(function () {
            $("#dropdown ul").css("display", ""), $("#apply>div>div").removeClass("open")
        }, 400)
    });
    var i = !1, a = Array();
    $.ajaxSetup({cache: !0}), $.getScript("https://connect.facebook.net/en_UK/all.js", function () {
        FB.init({appId: "611807002259648", xfbml: !0}), FB.getLoginStatus(e)
    }), $("#fb").click(function (e) {
        e.preventDefault(), i ? FB.ui({
            method: "feed",
            description: "Try your luck and win a free weekend in the city of Riga together with a celebrity.",
            caption: "I just chose the celebrity I want as my host in Riga!",
            name: "Celebrity couch",
            picture: "http://celebritycouch.lv/public/img/fb/" + $("#dropdown").data("id") + "-fb.png",
            link: "http://celebritycouch.lv"
        }, function (e) {
            e ? ($("#confirm-name").val(a.name), $("#confirm-email").val(a.email), $("#confirm").show()) : ($("#apply-error").html("Share your application to qualify for a fully paid trip to Riga."), $("#apply-error").show())
        }) : o()
    }), $(".toggle").click(function () {
        $(this).toggleClass("checked")
    }), $("#confirm-btn").click(function (e) {
        e.preventDefault();
        var o = $("#confirm-name").val(), i = $("#confirm-name").val(), a = $("#confirm-place").val(), l = $("#toggle-1").hasClass("checked"), r = $("#toggle-2").hasClass("checked"), n = !1;
        o.length < 2 ? ($("#name-error").show(), n = !0) : $("#name-error").hide(), i.length < 2 ? ($("#mail-error").show(), n = !0) : $("#mail-error").hide(), a.length < 2 ? ($("#place-error").show(), n = !0) : $("#place-error").hide(), l ? $("#toggle-1-error").hide() : ($("#toggle-1-error").show(), n = !0), r ? $("#toggle-2-error").hide() : ($("#toggle-2-error").show(), n = !0), n || (t(), $("#thanks").show())
    }), $(".nano").nanoScroller(), $("#terms").click(function (e) {
        e.preventDefault(), $("#terms-conditions").toggleClass("open")
    }), $("#terms-conditions .x").click(function (e) {
        e.preventDefault(), $("#terms-conditions").removeClass("open")
    })
});